@* Step 4: Review - Summary and confirmation before submission *@

<div class="wizard-step-content">
    <div class="step-header">
        <div class="step-icon">
            <i class="bi bi-check-circle"></i>
        </div>
        <h3 class="step-title">Review & Confirm</h3>
        <p class="step-description">Review your chord chart details before saving</p>
    </div>

    <div class="step-body">
        <div class="review-container">
            <!-- Chord Details Summary -->
            <div class="review-section">
                <div class="review-section-header">
                    <h4 class="review-section-title">
                        <i class="bi bi-music-note-beamed"></i>
                        Chord Details
                    </h4>
                    <button type="button" class="edit-button" @onclick="() => HandleJumpToStep(1)">
                        <i class="bi bi-pencil"></i>
                        Edit
                    </button>
                </div>
                <div class="review-content">
                    <div class="review-item">
                        <span class="review-label">Chord:</span>
                        <span class="review-value">@(SelectedChord?.ChordName ?? "Not selected")</span>
                    </div>
                    <div class="review-item">
                        <span class="review-label">Fret Position:</span>
                        <span class="review-value">@(FormModel.FretPosition?.ToString() ?? "Not specified")</span>
                    </div>
                </div>
            </div>

            <!-- Media Files Summary -->
            <div class="review-section">
                <div class="review-section-header">
                    <h4 class="review-section-title">
                        <i class="bi bi-file-earmark-image"></i>
                        Media Files
                    </h4>
                    <button type="button" class="edit-button" @onclick="() => HandleJumpToStep(2)">
                        <i class="bi bi-pencil"></i>
                        Edit
                    </button>
                </div>
                <div class="review-content">
                    <!-- Chart Image Preview -->
                    <div class="review-media-item">
                        <span class="review-label">Chart Image:</span>
                        @if (!string.IsNullOrEmpty(ChartPreview))
                        {
                            <div class="review-image-container">
                                <img src="@ChartPreview" alt="Chord chart preview" class="review-image" />
                            </div>
                        }
                        else
                        {
                            <span class="review-value-empty">No image uploaded</span>
                        }
                    </div>

                    <!-- Audio Preview -->
                    <div class="review-media-item">
                        <span class="review-label">Audio Sample:</span>
                        @if (!string.IsNullOrEmpty(AudioPreview))
                        {
                            <div class="review-audio-container">
                                <audio controls class="review-audio-player">
                                    <source src="@AudioPreview" />
                                    Your browser does not support this audio format.
                                </audio>
                            </div>
                        }
                        else
                        {
                            <span class="review-value-empty">No audio uploaded</span>
                        }
                    </div>
                </div>
            </div>

            <!-- Notes Summary -->
            <div class="review-section">
                <div class="review-section-header">
                    <h4 class="review-section-title">
                        <i class="bi bi-card-text"></i>
                        Notes
                    </h4>
                    <button type="button" class="edit-button" @onclick="() => HandleJumpToStep(3)">
                        <i class="bi bi-pencil"></i>
                        Edit
                    </button>
                </div>
                <div class="review-content">
                    @if (!string.IsNullOrEmpty(FormModel.PositionDescription))
                    {
                        <div class="review-notes">
                            <p>@FormModel.PositionDescription</p>
                        </div>
                    }
                    else
                    {
                        <span class="review-value-empty">No notes added</span>
                    }
                </div>
            </div>

            <!-- Ready to Submit Info -->
            <div class="review-info-card">
                <i class="bi bi-info-circle review-info-icon"></i>
                <div class="review-info-content">
                    <strong>Ready to save?</strong>
                    <p>Click "Save Chord Chart" below to create your chord chart. You can edit it anytime later.</p>
                </div>
            </div>
        </div>
    </div>
</div>

@code {
    [Parameter] public ChordChartDto FormModel { get; set; } = new();
    [Parameter] public ChordDto? SelectedChord { get; set; }
    [Parameter] public string ChartPreview { get; set; } = "";
    [Parameter] public string AudioPreview { get; set; } = "";
    [Parameter] public EventCallback<int> JumpToStep { get; set; }

    private async Task HandleJumpToStep(int step)
    {
        await JumpToStep.InvokeAsync(step);
    }
}
